<!DOCTYPE html>
<html>
<head>
  <script src="/javascripts/jquery-3.3.1.min.js"></script>
  <title><%= title %></title>
  <link rel='stylesheet' href='/stylesheets/bootstrap.css'/>
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <style>
    #read_table {
      width: 70%;
    }
    #delete_button{
      padding: 10px;
    }
    #comment_container{
      width: 100%;
    }
    body{ background: #fafafa;}
      .widget-area.blank {
      background: none repeat scroll 0 0 rgba(0, 0, 0, 0);
      -webkit-box-shadow: none;
      -moz-box-shadow: none;
      -ms-box-shadow: none;
      -o-box-shadow: none;
      box-shadow: none;
      }
      body .no-padding {
      padding: 0;
      }
      .widget-area {
      background-color: #fff;
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      -ms-border-radius: 4px;
      -o-border-radius: 4px;
      border-radius: 4px;
      -webkit-box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
      -moz-box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
      -ms-box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
      -o-box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
      box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
      float: left;
      margin-top: 30px;
      padding: 25px 30px;
      position: relative;
      width: 100%;
      }
      .status-upload {
      background: none repeat scroll 0 0 #f5f5f5;
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      -ms-border-radius: 4px;
      -o-border-radius: 4px;
      border-radius: 4px;
      float: left;
      width: 100%;
      }
      .status-upload form {
      float: left;
      width: 100%;
      }
      .status-upload form textarea {
      background: none repeat scroll 0 0 #fff;
      border: medium none;
      -webkit-border-radius: 4px 4px 0 0;
      -moz-border-radius: 4px 4px 0 0;
      -ms-border-radius: 4px 4px 0 0;
      -o-border-radius: 4px 4px 0 0;
      border-radius: 4px 4px 0 0;
      color: #777777;
      float: left;
      font-family: Lato;
      font-size: 14px;
      height: 142px;
      letter-spacing: 0.3px;
      padding: 20px;
      width: 100%;
      resize:vertical;
      outline:none;
      border: 1px solid #F2F2F2;
      }

      .status-upload ul {
      float: left;
      list-style: none outside none;
      margin: 0;
      padding: 0 0 0 15px;
      width: auto;
      }
      .status-upload ul > li {
      float: left;
      }
      .status-upload ul > li > a {
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      -ms-border-radius: 4px;
      -o-border-radius: 4px;
      border-radius: 4px;
      color: #777777;
      float: left;
      font-size: 14px;
      height: 30px;
      line-height: 30px;
      margin: 10px 0 10px 10px;
      text-align: center;
      -webkit-transition: all 0.4s ease 0s;
      -moz-transition: all 0.4s ease 0s;
      -ms-transition: all 0.4s ease 0s;
      -o-transition: all 0.4s ease 0s;
      transition: all 0.4s ease 0s;
      width: 30px;
      cursor: pointer;
      }
      .status-upload ul > li > a:hover {
      background: none repeat scroll 0 0 #606060;
      color: #fff;
      }
      .status-upload form button {
      border: medium none;
      -webkit-border-radius: 4px;
      -moz-border-radius: 4px;
      -ms-border-radius: 4px;
      -o-border-radius: 4px;
      border-radius: 4px;
      color: #fff;
      float: right;
      font-family: Lato;
      font-size: 14px;
      letter-spacing: 0.3px;
      margin-right: 9px;
      margin-top: 9px;
      padding: 6px 15px;
      }
      .dropdown > a > span.green:before {
      border-left-color: #2dcb73;
      }
      .status-upload form button > i {
      margin-right: 7px;
      }
      .comment-box {
        margin-top: 30px !important;
      }
      /* CSS Test end */

      .comment-box img {
        width: 50px;
        height: 50px;
      }
      .comment-box .media-left {
        padding-right: 10px;
        width: 65px;
      }
      .comment-box .media-body p {
        border: 1px solid #ddd;
        padding: 10px;
      }
      .comment-box .media-body .media p {
        margin-bottom: 0;
      }
      .comment-box .media-heading {
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        padding: 7px 10px;
        position: relative;
        margin-bottom: -1px;
      }
      .comment-box .media-heading:before {
        content: "";
        width: 12px;
        height: 12px;
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-width: 1px 0 0 1px;
        -webkit-transform: rotate(-45deg);
        transform: rotate(-45deg);
        position: absolute;
        top: 10px;
        left: -6px;
      }
  </style>
</head>
<body>
  <h3><%= title %></h3>
  <div id="delete_button">
  <form action="/infoboard/delete_info" method="get">
    <input type="hidden" name="idx" value="<%=row.idx%>"/>
    <button type="submit" class="btn">글 삭제</button>
  </form>
  <br>
  <a href="/infoboard/list_info/1"> 리스트로 돌아가기 </a>
  </div>
  <div id="read_table">
  <form action="/infoboard/update_info" method="get">
    <table border="1" class="table table-striped table-bordered">
      <input type="hidden" name="idx" value="<%=row.idx%>"/>
      <tr>
        <td>작성자</td>
        <td><%= row.creator_id %></td>
      </tr>
      <tr>
        <td>제목</td>
        <td><%=row.title%></td>
      </tr>
      <tr>
        <td>내용</td>
        <td><%=row.content%></td>
      </tr>
      <tr>
        <td>조회수</td>
        <td><%=row.hit%></td>
      </tr>
      <tr>
        <td>이미지</td>
        <td>
          <img src= <%='/uploads/infoboardimg/'+row.image%>>
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <button type="submit" class="btn">글 수정</button>
        </td>
      </tr>
    </table>
  </form>
  </div>
  <link rel="stylesheet" href="http://fontawesome.io/assets/font-awesome/css/font-awesome.css">
  <div class="container">
	<div class="row">
		<h3>댓글 달기</h3>
	</div>
    <div class="row">
    <div class="col-md-6">
    						<div class="widget-area no-padding blank">
								<div class="status-upload">
									<form>
										<textarea placeholder="댓글을 달아주세요." name="comment_content" id="comment_content" ></textarea>
										<ul>
											<li><a title="" data-toggle="tooltip" data-placement="bottom" data-original-title="Audio"><i class="fa fa-music"></i></a></li>
											<li><a title="" data-toggle="tooltip" data-placement="bottom" data-original-title="Video"><i class="fa fa-video-camera"></i></a></li>
											<li><a title="" data-toggle="tooltip" data-placement="bottom" data-original-title="Sound Record"><i class="fa fa-microphone"></i></a></li>
											<li><a title="" data-toggle="tooltip" data-placement="bottom" data-original-title="Picture"><i class="fa fa-picture-o"></i></a></li>
										</ul>
										<button type="button" class="btn btn-success green" name="comment_button" id="comment_button"><i class="fa fa-share"></i> 글쓰기</button>
									</form>
								</div><!-- Status Upload  -->
							</div><!-- Widget Area -->
			</div>
    </div>
  </div>
  <div id="comment_container" class='container'>
  		 <div class="media comment-box">
              <div class="media-left">
                  <a href="#">
                      <img class="img-responsive user-photo" src="https://ssl.gstatic.com/accounts/ui/avatar_2x.png">
                  </a>
              </div>
              <div class="media-body">
                  <h5 class="media-heading">Hyoryeong</h5>
                  <p>우와~귀엽네용</p>

              </div>
          </div>
  </div>
  <script type="text/javascript" src="/javascripts/bootstrap.js"></script>
  <script>
    var express = require('express');
    var router = express.Router();
    router.use(express.static('public'));
    //MySQL 로드
    var mysql = require('mysql');
    var pool = mysql.createPool({
      connectionLimit: 5,
      host: 'localhost',
      user: 'root',
      database: 'test',
      password: '12345'
    });

    $(function(){
      $("#comment_button").click(function(event, req, res, next){
        if($("#content_content").val().trim()!="")
        {
          var creator_id = "hyo";
          var content = $("#comment_content");
          var idx=$("#idx");

          var datas = [creator_id, content];

          pool.getConnection(function (err, connection){
            //Use the connection
            var sqlForInsertBoard = "insert into infoboard_comment(creator_id, content) values(?, ?)";
            connection.query(sqlForInsertBoard, datas, function(err, rows){
              if(err) console.error("err:" + err);
              //if(err) res.send(err);
              console.log("rows : " + JSON.stringify(rows));

              res.redirect('/infoboard/read_info/:idx');
              connection.release();

              //Don't use the connection here, it has been returned to the pool.
            });
          });
        }
      });
      $(document).ready(function(){
        $("[data-toggle=tooltip]").tooltip();
      });
  });
  </script>
</body>
</html>
